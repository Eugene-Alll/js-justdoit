!function(){"use strict";angular.element(document).ready(function(){angular.bootstrap(document,["llamaLists"])})}(),function(){"use strict";function t(t,e,s,n,a,r){a(t,e,s),r(n)}function e(t,e){t.initialize(),e.initialize()}angular.module("llamaLists",["ui.router","ngMessages","ngResource","ngAnimate"]).config(t).run(e),t.$inject=["$locationProvider","$stateProvider","$urlRouterProvider","$httpProvider","configRouter","configInterceptors"],e.$inject=["stateChangeSuccess","stateChangeError"]}(),function(){"use strict";function t(t){t.interceptors.push("AuthInterceptor")}angular.module("llamaLists").constant("configInterceptors",t)}(),function(){"use strict";function t(t,s,n){s.state("home",{url:"/",views:{navbar:{templateUrl:"navbar/navbar-auth/navbar-auth.tpl.html"},content:{templateUrl:"home/home.tpl.html"}}}).state("auth",{url:"","abstract":!0,resolve:{isUserLogged:e}}).state("auth.login",{url:"/login",views:{"content@":{templateUrl:"auth/auth-login/auth-login.tpl.html",controller:"loginPageCtrl",controllerAs:"loginVm"}}}).state("auth.signup",{url:"/signup",views:{"content@":{templateUrl:"auth/auth-signup/auth-signup.tpl.html",controller:"signupPageCtrl",controllerAs:"signupVm"}}}).state("main",{url:"","abstract":!0,views:{navbar:{templateUrl:"navbar/navbar-user/navbar-user.tpl.html",controller:"userNavCtrl",controllerAs:"navVm"}}}).state("main.lists",{url:"/:username",views:{"content@":{templateUrl:"main/main-lists/main-lists.tpl.html",controller:"listsPageCtrl",controllerAs:"listsVm"}}}).state("main.interests",{url:"/interests/",views:{"content@":{templateUrl:"main/main-interests/main-interests.tpl.html",controller:"interestsPageCtrl",controllerAs:"vm"}}}).state("main.profile",{url:"/profile",views:{"content@":{templateUrl:"main-profile/main-profile.tpl.html"}}}).state("main.profile.account",{url:"/account",views:{profile:{templateUrl:"main-profile/profile-account/profile-account.tpl.html",controller:"accountPageCtrl",controllerAs:"vm"}}}).state("main.profile.password",{url:"/password",views:{profile:{templateUrl:"main-profile/profile-password/profile-password.tpl.html",controller:"passwordPageCtrl",controllerAs:"vm"}}}).state("404",{url:"/404",views:{content:{templateUrl:"404/404.tpl.html"}}}),n.otherwise("/404"),t.html5Mode(!0)}function e(t){return t.logged()}angular.module("llamaLists").constant("configRouter",t),e.$inject=["userLogged"]}(),function(){"use strict";function t(t,e,s,n){return{request:function(t){return t.headers=t.headers||{},s.localStorage.token&&(t.headers.Authorization="Bearer "+s.localStorage.token),t},responseError:function(t){return 401===t.status?n.get("$state").go("home"):404===t.status&&n.get("$state").go("404"),e.reject(t)}}}angular.module("llamaLists").factory("AuthInterceptor",t),t.$inject=["$rootScope","$q","$window","$injector"]}(),function(){"use strict";function t(t){return t("/auth/:type",{type:"@type"},{save:{method:"POST",params:{type:"signup"}},login:{method:"POST",params:{type:"login"}}})}angular.module("llamaLists").factory("AuthService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(){this.setIsOwnFilter=function(t){this.isOwnFilter=t},this.getIsOwnFilter=function(){return this.isOwnFilter}}angular.module("llamaLists").service("listsFilter",t)}(),function(){"use strict";function t(t){var e=t("/api/lists/:id:user",{id:"@id",user:"@user"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}});return e}angular.module("llamaLists").factory("ListsService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t){var e=t("/api/search/:type",{},{lists:{method:"GET",params:{type:"lists"}},users:{method:"POST",params:{type:"users"}}});return e}angular.module("llamaLists").factory("SearchService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t,e,s){return{initialize:function(){t.$on("$stateChangeError",function(t,n,a,r,i,o){"isAlreadyLogged"===o&&e.go("main.lists",{username:s.localStorage.user})})}}}angular.module("llamaLists").factory("stateChangeError",t),t.$inject=["$rootScope","$state","$window"]}(),function(){"use strict";function t(t){return{initialize:function(){t.$on("$stateChangeSuccess",function(t,e){var s=e.name.split(".");document.body.id=s[s.length-1]+"-page"})}}}angular.module("llamaLists").factory("stateChangeSuccess",t),t.$inject=["$rootScope"]}(),function(){"use strict";function t(){this.getTagsAndText=function(t){var e=[],s=twttr.txt.extractHashtags(t);return s.forEach(function(s){-1===e.indexOf(s)&&e.push(s),-1===t.indexOf("<span>#"+s+"</span>")&&(t=t.replace("#"+s,"<span>#"+s+"</span>"))}),{text:t,hashTags:e}}}angular.module("llamaLists").service("tags",t)}(),function(){"use strict";function t(t){var e=t("/api/lists/:list/task/:task",{list:"@list",task:"@task"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}});return e}angular.module("llamaLists").factory("TaskService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t,e){this.getData=function(){return this.userData},this.setData=function(t){this.userData=t},this.isOwnerPage=function(){return t.localStorage.user!==e.username?!1:!0},this.isOwnerList=function(e){return t.localStorage.user!==e?!1:!0}}angular.module("llamaLists").service("userData",t),t.$inject=["$window","$stateParams"]}(),function(){"use strict";function t(t,e,s){this.logged=function(){var e=s.defer();return t.localStorage.token?e.reject("isAlreadyLogged"):e.resolve(),e.promise}}angular.module("llamaLists").service("userLogged",t),t.$inject=["$window","$state","$q"]}(),function(){"use strict";function t(t,e){var s=e.localStorage.user,n=t("/api/user/:name:type",{name:"@name",type:"@type"},{update:{method:"PUT"},getCurrentUser:{method:"GET",params:{name:s}},avatar:{method:"PUT",params:{type:"avatar"}},getInterests:{method:"GET",params:{type:"interests"}},setInterests:{method:"PUT",params:{type:"interests"}}});return n}angular.module("llamaLists").factory("UserService",t),t.$inject=["$resource","$window"]}(),function(){"use strict";function t(t,e,s,n,a,r,i){function o(t){t&&v&&(v=!1,n.save({list:this.listID},{text:this.taskText},function(t){S.data.tasks=t.tasks,S.taskText=null,v=!0}))}function l(){this.taskText=null}function u(){S.showInviteList=!1,S.showBackground=!1}function c(){this.showBackground=!1,this.showInviteList=!1,e.$emit("hideFogOverlay")}function m(){this.showInviteList=!0,e.$emit("showFogOverlay")}function d(){this.showBackground=!0,e.$emit("showFogOverlay")}function f(){s["delete"]({id:this.listID},function(){S.reload()})}function h(){w=this.data.title,this.data.title=this.data.title.replace(/(<([^>]+)>)/gi,""),$=this.data.title}function g(){if($&&$!==this.data.title){var t=i.getTagsAndText(this.data.title);this.data.title=t.text,this.data.tags=t.hashTags,s.update({id:this.listID},{list:this.data})}else this.data.title=w}function p(t){n.query({list:t},function(t){S.data.tasks=t.tasks})}var v=!0,w="",$="",S=this;this.listID=this.data._id,this.isOwner=r.isOwnerList(this.data.owner.name),t.$watch(function(){return a.getIsOwnFilter()},function(){S.isOwnFilter=a.getIsOwnFilter()}),this.addNewTask=o,this.clearInput=l,this.closePopupAndOverlay=c,this.invitePeople=m,this.openBackgroundPopup=d,this.saveEditedTitle=g,this.saveTextToTemp=h,this.removeList=f,this.reloadTasks=p,t.$on("closePopup",u)}angular.module("llamaLists").component("list",{bindings:{data:"=",reload:"&"},controller:t,templateUrl:"scripts/common/components/list/list.tpl.html"}),t.$inject=["$scope","$rootScope","ListsService","TaskService","listsFilter","userData","tags"]}(),function(){"use strict";function t(t){function e(e){var s=e.target.className,n=angular.element(e.target);n.hasClass("task__color--active")||(s=s.replace("task__color ",""),t.update({list:u,task:d},{color:s},function(t){f.data.color=s}))}function s(){this.data.text=m,this.editMode=!1}function n(){this.dropdownIsOpen=!1}function a(){m=this.data.text,this.editMode=!0,this.focusOn=!0,this.closeDropdown()}function r(t){t.currentTarget===t.target&&(this.dropdownIsOpen=this.dropdownIsOpen?!1:!0)}function i(e){this.editMode!==!0&&t.update({list:u,task:d},{completed:!0},function(t){f.data.completed=t.task.completed})}function o(){this.data.text?t.update({list:u,task:d},{text:this.data.text},function(t){f.editMode=!1}):this.closeEditMode()}function l(){t["delete"]({list:u,task:d},function(t){c(u)})}var u,c,m,d=this.data._id,f=this;this.dropdownIsOpen=!1,this.changeColor=e,this.closeEditMode=s,this.closeDropdown=n,this.editTaskText=a,this.openDropdown=r,this.setTaskCompleted=i,this.saveEditedText=o,this.removeTask=l,this.$onInit=function(){u=this.listCtrl.listID,c=this.listCtrl.reloadTasks}}angular.module("llamaLists").component("task",{bindings:{data:"="},require:{listCtrl:"^list"},controller:t,templateUrl:"scripts/common/components/task/task.tpl.html"}),t.$inject=["TaskService"]}(),function(){"use strict";function t(){function t(t,e,s){e.bind("keypress",function(e){13===e.which&&t.$apply(function(){t.$eval(s.clickEnter)})})}var e={restrict:"A",link:t};return e}angular.module("llamaLists").directive("clickEnter",t)}(),function(){"use strict";function t(t,e){function s(s,n,a){var r=e(a.clickOutside),i=function(t){var e=n[0].contains(t.target);if(t&&t.target&&!e)return s.$apply(function(){return r(s)})};t.on("click",i),s.$on("$destroy",function(){t.off("click",i)})}var n={restrict:"A",link:s};return n}angular.module("llamaLists").directive("clickOutside",t),t.$inject=["$document","$parse"]}(),function(){"use strict";function t(){function t(t,e,s,n){function a(){n.$setViewValue(e.html())}n.$render=function(){e.html(n.$viewValue||"")},e.bind("blur keyup change",function(){t.$apply(a)})}var e={restrict:"A",require:"ngModel",link:t};return e}angular.module("llamaLists").directive("contenteditable",t)}(),function(){"use strict";function t(t){function e(e,s,n){e.$watch("trigger",function(n){n&&t(function(){s[0].focus(),e.trigger=!1})})}var s={restrict:"A",scope:{trigger:"=customFocus"},link:e};return s}angular.module("llamaLists").directive("customFocus",t),t.$inject=["$timeout"]}(),function(){"use strict";function t(t){function e(e,s,n){function a(t){e.$apply(function(){r(e,{image:t.target.files[0]})})}var r=t(n.fileReader);s.bind("change",a)}var s={restrict:"A",link:e};return s}angular.module("llamaLists").directive("fileReader",t),t.$inject=["$parse"]}(),function(){"use strict";function t(t){function e(e,s,n){function a(){e.showFogState=!1,e.$parent.$broadcast("closePopup")}function r(){e.showFogState=!0}var i=t.$on("showFogOverlay",r),o=t.$on("hideFogOverlay",a);e.hideFogOverlay=a,e.$on("$destroy",i),e.$on("$destroy",o)}var s={restrict:"E",replace:!0,scope:{},template:"<div id='fog' ng-show='showFogState' ng-click='hideFogOverlay()'></div>",link:e};return s}angular.module("llamaLists").directive("fog",t),t.$inject=["$rootScope"]}(),function(){"use strict";function t(t){function e(e,s,n,a){function r(){s.hasClass("active-background")||(a.data.image=n["class"],s.parent().children().removeClass("active-background"),t.update({id:a.listID},{list:a.data},function(t){s.addClass("active-background")}))}n["class"]===a.data.image&&s.addClass("active-background"),s.bind("click",r)}var s={restrict:"A",require:"^list",replace:!0,scope:{},link:e};return s}angular.module("llamaLists").directive("listBackground",t),t.$inject=["ListsService"]}(),function(){"use strict";function t(t,e){function s(s,n,a,r){function i(){r.data.members.forEach(function(t){t.interests=t.interests.slice(0,3),s.stash.push(t),d.push(t.name)}),d.push(r.data.owner.name)}function o(){s.members?t.users({},{name:s.members,usedNames:d},function(t){s.users=t.users,s.users&&s.users.length>0?s.showSearchResult=!0:s.showSearchResult=!1}):s.showSearchResult=!1}function l(t){s.stash.push(t),d.push(t.name),s.showSearchResult=!1,s.members=null,s.users=null}function u(t){var e;s.stash.forEach(function(e,n){s.stash[n].name===t.name&&s.stash.splice(n,1)}),e=d.indexOf(t.name),e>-1&&d.splice(e,1)}function c(){var t=r.data;t.members=s.stash,e.update({id:r.listID},{list:t},function(t){m(),r.showInviteList=!0,r.closePopupAndOverlay()})}function m(){d=[],s.showSearchResult=!1,s.members=null,s.stash=[],s.users=[]}var d=[];s.owner=r.data.owner,s.stash=[],s.searchPeople=o,s.saveToStash=l,s.removeFromStash=u,s.saveToMembers=c,s.$watch(function(){return r.showInviteList},function(t){t===!0?i():m()})}var n={restrict:"E",require:"^list",replace:!0,templateUrl:"scripts/common/directives/list-invite/list-invite.tpl.html",link:s};return n}angular.module("llamaLists").directive("listInvite",t),t.$inject=["SearchService","ListsService"]}(),function(){"use strict";function t(t,e,s,n,a,r,i){function o(e,o,l){function u(){r.getData()?e.currentUserData=r.getData():s.getCurrentUser(function(t){r.setData(t.user),e.currentUserData=t.user})}function c(s){if(e.newListSubmitted=!0,s){var n=i.getTagsAndText(e.newListTitle),r=n.text,o=n.hashTags;a.save({title:r,tags:o,members:e.members},function(s){e.lists.push(s.list),t.$emit("hideFogOverlay"),h()})}}function m(){e.searchUser?n.users({},{name:e.searchUser,usedNames:g},function(t){e.users=t.users,e.users&&e.users.length>0?e.showSearchResult=!0:e.showSearchResult=!1}):e.showSearchResult=!1}function d(t){e.members.push(t),g.push(t.name),e.showSearchResult=!1,e.searchUser=null,e.users=[]}function f(t){var s;e.members.forEach(function(s,n){e.members[n].name===t.name&&e.members.splice(n,1)}),s=g.indexOf(t.name),s>-1&&g.splice(s,1)}function h(){e.showSearchResult=!1,e.users=[],e.members=[],e.searchUser=null,e.nameMember=null,e.newListTitle=null,e.newListForm.$setPristine(),e.newListSubmitted=!1,g=[]}e.showSearchResult=!1,e.members=[],e.saveNewList=c,e.searchPeople=m,e.saveToMembers=d,e.removeFromMembers=f;var g=[];e.$watch(function(){return e.show},function(t){t===!0?(e.focus=!0,g.push(e.currentUserData.name)):h()}),u()}var l={restrict:"E",replace:!0,scope:{lists:"=",show:"="},templateUrl:"scripts/common/directives/new-list/new-list.tpl.html",link:o};return l}angular.module("llamaLists").directive("newList",t),t.$inject=["$rootScope","$window","UserService","SearchService","ListsService","userData","tags"]}(),function(){"use strict";function t(t,e,s){function n(n){if(r.submitted=!0,n){var a={username:r.username,password:r.password};s.login({},a,function(s){t.localStorage.token=s.token,t.localStorage.user=r.username,e.go("main.lists",{username:r.username})},function(e){delete t.localStorage.token,r.message=e.data.message})}}function a(){r.message=null}var r=this;r.submitted,r.submitData=n,r.clearMessageError=a}angular.module("llamaLists").controller("loginPageCtrl",t),t.$inject=["$window","$state","AuthService"]}(),function(){"use strict";function t(t,e,s){function n(n){if(r.submitted=!0,n){var a={username:r.userName,email:r.userEmail,password:r.userPassword};s.save({},a,function(s){t.localStorage.token=s.token,t.localStorage.user=r.userName,e.go("main.interests")},function(e){delete t.localStorage.token,r.message=e.data.message})}}function a(){r.message=null}var r=this;r.submitted,r.message,r.submitData=n,r.clearMessageError=a}angular.module("llamaLists").controller("signupPageCtrl",t),t.$inject=["$window","$state","AuthService"]}(),function(){"use strict";function t(t,e,s,n){function a(t,e){var s=angular.element(t.target);6>l&&(s.addClass("chosen-interest"),o.selectedInterest.push({text:s.text(),color:u[0],id:e}),u.shift(),l++)}function r(t,e){var s=t.target.dataset.selectedId;o.selectedInterest.splice(e,1),angular.element(document.querySelectorAll("[data-id='"+s+"']")).removeClass("chosen-interest"),u.push(t.target.dataset.color),l--}function i(){var t=[];o.selectedInterest.length>0?(o.selectedInterest.forEach(function(e){t.push(e.text)}),n.setInterests({},{interests:t},function(t){s.go("main.lists")})):o.emptyInterests=o.emptyInterests?!1:!0}var o=this,l=0,u=["red","orange","yellow","green","indigo","violet"];o.interests=[],o.selectedInterest=[],o.chooseInterest=a,o.removeInterest=r,o.saveInterests=i,o.username=e.localStorage.user,n.getInterests(function(e){t(function(){o.interests=e.interests},100)})}angular.module("llamaLists").controller("interestsPageCtrl",t),t.$inject=["$timeout","$window","$state","UserService"]}(),function(){"use strict";function t(t,e,s,n,a,r,i){function o(){d.isCurrentUser!==!0&&a.get({name:f},function(t){d.user=t.user}),n.get({user:f},function(t){d.lists=t.lists})}function l(){d.showNewList=!0,e.$emit("showFogOverlay")}function u(){n.get({user:f},function(t){d.lists=t.lists})}function c(t){d.filter={owner:{}},"own"===t?(d.filter.owner.name="Eugene",i.setIsOwnFilter(!0)):"inbox"===t&&(d.filter.owner.name="!Eugene",i.setIsOwnFilter(!1))}function m(){d.showNewList=!1}var d=this,f=s.username;d.showNewList,d.newListSubmitted,d.createNewList=l,d.selectSort=c,d.reloadList=u,d.isOwner=r.isOwnerPage(),t.$on("closePopup",m),o()}angular.module("llamaLists").controller("listsPageCtrl",t),t.$inject=["$scope","$rootScope","$stateParams","ListsService","UserService","userData","listsFilter"]}(),function(){"use strict";function t(t,e,s,n){function a(){n.getData()?l.user=n.getData():s.getCurrentUser(function(t){n.setData(t.user),l.user=t.user})}function r(t){t&&(l.message=null,l.messageDone=null,s.update({},{user:l.user},function(t){l.messageDone=t.message,e.$emit("reloadNavbar")},function(t){l.message=t.data.message}))}function i(t){var n;0!==t.type.localeCompare("image/jpeg")&&0!==t.type.localeCompare("image/png")&&console.log("error"),n=new FileReader,n.onload=function(t){s.avatar({},{avatar:t.target.result},function(t){l.avatarImage=t.avatar,e.$emit("reloadNavbar")})},n.readAsDataURL(t)}function o(){l.message=null}var l=this;l.saveChanges=r,l.changeAvatar=i,l.clearMessageError=o,a()}angular.module("llamaLists").controller("accountPageCtrl",t),t.$inject=["$window","$rootScope","UserService","userData"]}(),function(){"use strict";function t(t){function e(e){s.submitted=!0,s.errorConfirmPass=null,s.message=null,s.messageDone=null;var n={};e&&(s.newPass===s.newPassConfirm?(n={oldPass:s.oldPass,newPass:s.newPassConfirm},t.save({},n,function(t){s.messageDone=t.message},function(t){s.message=t.data.message})):s.errorConfirmPass=!0)}var s=this;s.savePassword=e}angular.module("llamaLists").controller("passwordPageCtrl",t),t.$inject=["UserService"]}(),function(){"use strict";function t(t,e,s,n,a,r){function i(){r.getData()?m.user=r.getData():a.getCurrentUser(function(t){r.setData(t.user),m.user=t.user})}function o(t){m.dropdownIsOpen=m.dropdownIsOpen?!1:!0}function l(){m.dropdownIsOpen=!1}function u(t){var e;0!==t.type.localeCompare("image/jpeg")&&0!==t.type.localeCompare("image/png")&&console.log("error"),e=new FileReader,e.onload=function(t){a.avatar({},{avatar:t.target.result},function(t){m.avatarImage=t.avatar})},e.readAsDataURL(t)}function c(){delete n.localStorage.token,s.go("home")}var m=this;m.user={},m.logout=c,m.openDropdown=o,m.changeAvatar=u,m.closeDropdown=l,m.username=n.localStorage.user;var d=t.$on("reloadNavbar",i);i(),e.$on("$destroy",d)}angular.module("llamaLists").controller("userNavCtrl",t),t.$inject=["$rootScope","$scope","$state","$window","UserService","userData"]}();
//# sourceMappingURL=main.min.js.map
