!function(){"use strict";angular.element(document).ready(function(){angular.bootstrap(document,["llamaLists"])})}(),function(){"use strict";function t(t,e,s,n,a,i){a(t,e,s),i(n)}function e(t,e){t.initialize(),e.initialize()}angular.module("llamaLists",["ui.router","ngMessages","ngResource","ngAnimate"]).config(t).run(e),t.$inject=["$locationProvider","$stateProvider","$urlRouterProvider","$httpProvider","configRouter","configInterceptors"],e.$inject=["stateChangeSuccess","stateChangeError"]}(),function(){"use strict";function t(t){t.interceptors.push("AuthInterceptor")}angular.module("llamaLists").constant("configInterceptors",t)}(),function(){"use strict";function t(t,s,n){s.state("home",{url:"/",views:{navbar:{templateUrl:"navbar/navbar-auth/navbar-auth.tpl.html"},content:{templateUrl:"home/home.tpl.html"}}}).state("auth",{url:"","abstract":!0,resolve:{isUserLogged:e}}).state("auth.login",{url:"/login",views:{"content@":{templateUrl:"auth/auth-login/auth-login.tpl.html",controller:"loginPageCtrl",controllerAs:"loginVm"}}}).state("auth.signup",{url:"/signup",views:{"content@":{templateUrl:"auth/auth-signup/auth-signup.tpl.html",controller:"signupPageCtrl",controllerAs:"signupVm"}}}).state("main",{url:"","abstract":!0,views:{navbar:{templateUrl:"navbar/navbar-user/navbar-user.tpl.html",controller:"userNavCtrl",controllerAs:"navVm"}}}).state("main.lists",{url:"/:username",views:{"content@":{templateUrl:"main/main-lists/main-lists.tpl.html",controller:"listsPageCtrl",controllerAs:"listsVm"}}}).state("main.interests",{url:"/interests/",views:{"content@":{templateUrl:"main/main-interests/main-interests.tpl.html",controller:"interestsPageCtrl",controllerAs:"vm"}}}).state("main.profile",{url:"/profile",views:{"content@":{templateUrl:"main-profile/main-profile.tpl.html"}}}).state("main.profile.account",{url:"/account",views:{profile:{templateUrl:"main-profile/profile-account/profile-account.tpl.html",controller:"accountPageCtrl",controllerAs:"vm"}}}).state("main.profile.password",{url:"/password",views:{profile:{templateUrl:"main-profile/profile-password/profile-password.tpl.html",controller:"passwordPageCtrl",controllerAs:"vm"}}}).state("404",{url:"/404",views:{content:{templateUrl:"404/404.tpl.html"}}}),n.otherwise("/404"),t.html5Mode(!0)}function e(t){return t.logged()}angular.module("llamaLists").constant("configRouter",t),e.$inject=["userLogged"]}(),function(){"use strict";function t(t,e,s,n){return{request:function(t){return t.headers=t.headers||{},s.localStorage.token&&(t.headers.Authorization="Bearer "+s.localStorage.token),t},responseError:function(t){return 401===t.status?n.get("$state").go("home"):404===t.status&&n.get("$state").go("404"),e.reject(t)}}}angular.module("llamaLists").factory("AuthInterceptor",t),t.$inject=["$rootScope","$q","$window","$injector"]}(),function(){"use strict";function t(t){return t("/auth/:type",{type:"@type"},{save:{method:"POST",params:{type:"signup"}},login:{method:"POST",params:{type:"login"}}})}angular.module("llamaLists").factory("AuthService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t){var e=t("/api/lists/:id:user",{id:"@id",user:"@user"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}});return e}angular.module("llamaLists").factory("ListsService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t){var e=t("/api/search/:type",{},{lists:{method:"GET",params:{type:"lists"}},users:{method:"POST",params:{type:"users"}}});return e}angular.module("llamaLists").factory("SearchService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t,e,s){return{initialize:function(){t.$on("$stateChangeError",function(t,n,a,i,r,o){"isAlreadyLogged"===o&&e.go("main.lists",{username:s.localStorage.user})})}}}angular.module("llamaLists").factory("stateChangeError",t),t.$inject=["$rootScope","$state","$window"]}(),function(){"use strict";function t(t){return{initialize:function(){t.$on("$stateChangeSuccess",function(t,e){var s=e.name.split(".");document.body.id=s[s.length-1]+"-page"})}}}angular.module("llamaLists").factory("stateChangeSuccess",t),t.$inject=["$rootScope"]}(),function(){"use strict";function t(){this.getTagsAndText=function(t){var e=[],s=twttr.txt.extractHashtags(t);return s.forEach(function(s){-1===e.indexOf(s)&&e.push(s),-1===t.indexOf("<span>#"+s+"</span>")&&(t=t.replace(new RegExp("#"+s,"g"),"<span>#"+s+"</span>"))}),{text:t,hashTags:e}}}angular.module("llamaLists").service("tags",t)}(),function(){"use strict";function t(t){var e=t("/api/lists/:list/task/:task",{list:"@list",task:"@task"},{query:{method:"GET",isArray:!1},update:{method:"PUT"}});return e}angular.module("llamaLists").factory("TaskService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t,e,s){this.logged=function(){var e=s.defer();return t.localStorage.token?e.reject("isAlreadyLogged"):e.resolve(),e.promise}}angular.module("llamaLists").service("userLogged",t),t.$inject=["$window","$state","$q"]}(),function(){"use strict";function t(t){var e=t("/api/user/:type",{type:"@type"},{update:{method:"PUT"},avatar:{method:"PUT",params:{type:"avatar"}},getInterests:{method:"GET",params:{type:"interests"}},setInterests:{method:"PUT",params:{type:"interests"}}});return e}angular.module("llamaLists").factory("UserService",t),t.$inject=["$resource"]}(),function(){"use strict";function t(t,e,s){function n(n){if(i.submitted=!0,n){var a={username:i.username,password:i.password};s.login({},a,function(s){t.localStorage.token=s.token,t.localStorage.user=i.username,e.go("main.lists",{username:i.username})},function(e){delete t.localStorage.token,i.message=e.data.message})}}function a(){i.message=null}var i=this;i.submitted,i.submitData=n,i.clearMessageError=a}angular.module("llamaLists").controller("loginPageCtrl",t),t.$inject=["$window","$state","AuthService"]}(),function(){"use strict";function t(t,e,s){function n(n){if(i.submitted=!0,n){var a={username:i.userName,email:i.userEmail,password:i.userPassword};s.save({},a,function(s){t.localStorage.token=s.token,t.localStorage.user=i.userName,e.go("main.interests")},function(e){delete t.localStorage.token,i.message=e.data.message})}}function a(){i.message=null}var i=this;i.submitted,i.message,i.submitData=n,i.clearMessageError=a}angular.module("llamaLists").controller("signupPageCtrl",t),t.$inject=["$window","$state","AuthService"]}(),function(){"use strict";function t(t,e,s,n){function a(t,e){var s=angular.element(t.target);6>l&&(s.addClass("chosen-interest"),o.selectedInterest.push({text:s.text(),color:c[0],id:e}),c.shift(),l++)}function i(t,e){var s=t.target.dataset.selectedId;o.selectedInterest.splice(e,1),angular.element(document.querySelectorAll("[data-id='"+s+"']")).removeClass("chosen-interest"),c.push(t.target.dataset.color),l--}function r(){var t=[];o.selectedInterest.length>0?(o.selectedInterest.forEach(function(e){t.push(e.text)}),n.setInterests({},{interests:t},function(t){s.go("main.lists")})):o.emptyInterests=o.emptyInterests?!1:!0}var o=this,l=0,c=["red","orange","yellow","green","indigo","violet"];o.interests=[],o.selectedInterest=[],o.chooseInterest=a,o.removeInterest=i,o.saveInterests=r,o.username=e.localStorage.user,n.getInterests(function(e){t(function(){o.interests=e.interests},100)})}angular.module("llamaLists").controller("interestsPageCtrl",t),t.$inject=["$timeout","$window","$state","UserService"]}(),function(){"use strict";function t(t,e,s,n,a,i){function r(){a.get({user:d},function(t){m.lists=t.lists})}function o(){m.newListPopup=!0,m.focus=!0,e.$emit("showFogOverlay")}function l(t){a.get({user:d},function(e){m.lists=e.lists,t&&t()})}function c(t){if(m.newListSubmitted=!0,t){var s=i.getTagsAndText(m.newListTitle),n=s.text,r=s.hashTags;a.save({title:n,tags:r},function(t){l(function(){e.$emit("hideFogOverlay"),m.newListTitle=null,m.newListForm.$setPristine(),m.newListSubmitted=!1})})}}function u(){m.newListPopup=!1}var m=this,d=s.username;m.newListPopup,m.newListSubmitted,m.createNewList=o,m.saveNewList=c,m.reloadList=l,t.$on("closePopup",u),r()}angular.module("llamaLists").controller("listsPageCtrl",t),t.$inject=["$scope","$rootScope","$stateParams","$window","ListsService","tags"]}(),function(){"use strict";function t(t,e){function s(){e.get(function(t){r.avatarImage=t.user.avatar,r.name=t.user.name,r.email=t.user.email,r.bio=t.user.bio})}function n(s){var n={};s&&(n.name=r.name,n.email=r.email,n.bio=r.bio,r.message=null,r.messageDone=null,e.update({},n,function(e){r.messageDone=e.message,t.$emit("reloadNavbar")},function(t){r.message=t.data.message}))}function a(s){var n;0!==s.type.localeCompare("image/jpeg")&&0!==s.type.localeCompare("image/png")&&console.log("error"),n=new FileReader,n.onload=function(s){e.avatar({},{avatar:s.target.result},function(e){r.avatarImage=e.avatar,t.$emit("reloadNavbar")})},n.readAsDataURL(s)}function i(){r.message=null}var r=this;r.saveChanges=n,r.changeAvatar=a,r.clearMessageError=i,s()}angular.module("llamaLists").controller("accountPageCtrl",t),t.$inject=["$rootScope","UserService"]}(),function(){"use strict";function t(t){function e(e){s.submitted=!0,s.errorConfirmPass=null,s.message=null,s.messageDone=null;var n={};e&&(s.newPass===s.newPassConfirm?(n={oldPass:s.oldPass,newPass:s.newPassConfirm},t.save({},n,function(t){s.messageDone=t.message},function(t){s.message=t.data.message})):s.errorConfirmPass=!0)}var s=this;s.savePassword=e}angular.module("llamaLists").controller("passwordPageCtrl",t),t.$inject=["UserService"]}(),function(){"use strict";function t(t,e,s,n,a){function i(){a.get({},function(t){u.name=t.user.name,u.avatarImage=t.user.avatar})}function r(t){u.dropdownIsOpen=u.dropdownIsOpen?!1:!0}function o(){u.dropdownIsOpen=!1}function l(t){var e;0!==t.type.localeCompare("image/jpeg")&&0!==t.type.localeCompare("image/png")&&console.log("error"),e=new FileReader,e.onload=function(t){a.avatar({},{avatar:t.target.result},function(t){u.avatarImage=t.avatar})},e.readAsDataURL(t)}function c(){delete n.localStorage.token,s.go("home")}var u=this;u.logout=c,u.openDropdown=r,u.changeAvatar=l,u.closeDropdown=o,u.username=n.localStorage.user;var m=t.$on("reloadNavbar",i);i(),e.$on("$destroy",m)}angular.module("llamaLists").controller("userNavCtrl",t),t.$inject=["$rootScope","$scope","$state","$window","UserService"]}(),function(){"use strict";function t(t,e,s,n,a,i){function r(t){t&&h&&(h=!1,a.save({list:this.listID},{text:this.taskText},function(t){w.data.tasks=t.tasks,w.taskText=null,h=!0}))}function o(){this.taskText=null}function l(){w.showInviteList=!1,w.showBackground=!1}function c(){this.showBackground=!1,this.showInviteList=!1,e.$emit("hideFogOverlay")}function u(){this.showInviteList=!0,e.$emit("showFogOverlay")}function m(){this.showBackground=!0,e.$emit("showFogOverlay")}function d(){n["delete"]({id:this.listID},function(){w.reload()})}function g(){v=this.data.title,this.data.title=this.data.title.replace(/(<([^>]+)>)/gi,""),$=this.data.title}function f(){if($&&$!==this.data.title){var t=i.getTagsAndText(this.data.title);this.data.title=t.text,this.data.tags=t.hashTags,n.update({id:this.listID},{list:this.data})}else this.data.title=v}function p(t){a.query({list:t},function(t){w.data.tasks=t.tasks})}var h=!0,v="",$="",w=this;this.listID=this.data._id,this.addNewTask=r,this.clearInput=o,this.closePopupAndOverlay=c,this.invitePeople=u,this.openBackgroundPopup=m,this.saveEditedTitle=f,this.saveTextToTemp=g,this.removeList=d,this.reloadTasks=p,t.$on("closePopup",l)}angular.module("llamaLists").component("list",{bindings:{data:"=",reload:"&"},controller:t,templateUrl:"scripts/common/components/list/list.tpl.html"}),t.$inject=["$scope","$rootScope","$timeout","ListsService","TaskService","tags"]}(),function(){"use strict";function t(t){function e(e){var s=e.target.className,n=angular.element(e.target);n.hasClass("task__color--active")||(s=s.replace("task__color ",""),t.update({list:c,task:d},{color:s},function(t){g.data.color=s}))}function s(){this.data.text=m,this.editMode=!1}function n(){this.dropdownIsOpen=!1}function a(){m=this.data.text,this.editMode=!0,this.focusOn=!0,this.closeDropdown()}function i(t){t.currentTarget===t.target&&(this.dropdownIsOpen=this.dropdownIsOpen?!1:!0)}function r(e){this.editMode!==!0&&t.update({list:c,task:d},{completed:!0},function(t){g.data.completed=t.task.completed})}function o(){this.data.text?t.update({list:c,task:d},{text:this.data.text},function(t){g.editMode=!1}):this.closeEditMode()}function l(){t["delete"]({list:c,task:d},function(t){u(c)})}var c,u,m,d=this.data._id,g=this;this.dropdownIsOpen=!1,this.changeColor=e,this.closeEditMode=s,this.closeDropdown=n,this.editTaskText=a,this.openDropdown=i,this.setTaskCompleted=r,this.saveEditedText=o,this.removeTask=l,this.$onInit=function(){c=this.listCtrl.listID,u=this.listCtrl.reloadTasks}}angular.module("llamaLists").component("task",{bindings:{data:"="},require:{listCtrl:"^list"},controller:t,templateUrl:"scripts/common/components/task/task.tpl.html"}),t.$inject=["TaskService"]}(),function(){"use strict";function t(t,e){function s(s,n,a){var i=e(a.clickOutside),r=function(t){var e=n[0].contains(t.target);if(t&&t.target&&!e)return s.$apply(function(){return i(s)})};t.on("click",r),s.$on("$destroy",function(){t.off("click",r)})}var n={restrict:"A",link:s};return n}angular.module("llamaLists").directive("clickOutside",t),t.$inject=["$document","$parse"]}(),function(){"use strict";function t(){function t(t,e,s,n){function a(){n.$setViewValue(e.html())}n.$render=function(){e.html(n.$viewValue||"")},e.bind("blur keyup change",function(){t.$apply(a)})}var e={restrict:"A",require:"ngModel",link:t};return e}angular.module("llamaLists").directive("contenteditable",t)}(),function(){"use strict";function t(){function t(t,e,s){e.bind("keypress",function(e){13===e.which&&t.$apply(function(){t.$eval(s.clickEnter)})})}var e={restrict:"A",link:t};return e}angular.module("llamaLists").directive("clickEnter",t)}(),function(){"use strict";function t(t){function e(e,s,n){e.$watch("trigger",function(n){n&&t(function(){s[0].focus(),e.trigger=!1})})}var s={restrict:"A",scope:{trigger:"=customFocus"},link:e};return s}angular.module("llamaLists").directive("customFocus",t),t.$inject=["$timeout"]}(),function(){"use strict";function t(t){function e(e,s,n){function a(t){e.$apply(function(){i(e,{image:t.target.files[0]})})}var i=t(n.fileReader);s.bind("change",a)}var s={restrict:"A",link:e};return s}angular.module("llamaLists").directive("fileReader",t),t.$inject=["$parse"]}(),function(){"use strict";function t(t){function e(e,s,n){function a(){e.showFogState=!1,e.$parent.$broadcast("closePopup")}function i(){e.showFogState=!0}var r=t.$on("showFogOverlay",i),o=t.$on("hideFogOverlay",a);e.hideFogOverlay=a,e.$on("$destroy",r),e.$on("$destroy",o)}var s={restrict:"E",replace:!0,scope:{},template:"<div id='fog' ng-show='showFogState' ng-click='hideFogOverlay()'></div>",link:e};return s}angular.module("llamaLists").directive("fog",t),t.$inject=["$rootScope"]}(),function(){"use strict";function t(t){function e(e,s,n,a){function i(){s.hasClass("active-background")||(a.data.image=n["class"],s.parent().children().removeClass("active-background"),t.update({id:a.listID},{list:a.data},function(t){s.addClass("active-background")}))}n["class"]===a.data.image&&s.addClass("active-background"),s.bind("click",i)}var s={restrict:"A",require:"^list",replace:!0,scope:{},link:e};return s}angular.module("llamaLists").directive("listBackground",t),t.$inject=["ListsService"]}(),function(){"use strict";function t(t,e){function s(s,n,a,i){function r(){i.data.members.forEach(function(t){t.interests=t.interests.slice(0,3),s.stash.push(t),m.push(t.name)}),console.log(i.data.members),m.push(i.data.owner.name)}function o(){s.members?t.users({},{name:s.members,usedNames:m},function(t){s.users=t.users,s.users&&s.users.length>0?s.showSearchResult=!0:s.showSearchResult=!1}):s.showSearchResult=!1}function l(t){s.stash.push(t),m.push(t.name),s.showSearchResult=!1,s.members=null,s.users=null}function c(t){var e;s.stash.forEach(function(e,n){s.stash[n].name===t.name&&s.stash.splice(n,1)}),e=m.indexOf(t.name),e>-1&&m.splice(e,1)}function u(){var t=i.data;t.members=s.stash,e.update({id:i.listID},{list:t},function(t){i.showInviteList=!0,i.closePopupAndOverlay()})}var m=[];s.owner=i.data.owner,s.stash=[],s.searchPeople=o,s.saveToStash=l,s.removeFromStash=c,s.saveToMembers=u,s.$watch(function(){return i.showInviteList},function(t){t===!0?r():s.stash=[]})}var n={restrict:"E",require:"^list",replace:!0,templateUrl:"scripts/common/directives/list-invite/list-invite.tpl.html",link:s};return n}angular.module("llamaLists").directive("listInvite",t),t.$inject=["SearchService","ListsService"]}();
//# sourceMappingURL=main.min.js.map
